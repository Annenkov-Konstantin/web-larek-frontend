# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/components/Model/ - папка с классами модели данных
- src/components/View/ - папка м классами отображения

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар

```
interface IItemModel {
	id: string;
	title: string;
	image: string;
	category: string;
	description: string;
	price: number | null;
}
```

Интерфейс для модели работы с данными товаров

```
interface IItemsCatalogModel {
	catalog: IItemModel[];
	selectedItem: IItemModel;
	processImagesSrc(catalog: IItemModel[]): IItemModel[];
	setSelectedItem(id: string): void;
	clearSelectedItem(): void;
	getItem(id: string): ItemBasket;
}
```

Интерфейс для модели данных корзины товаров

```
interface IBasketModel {
	itemsList: ItemBasket[];
	addItem(item: ItemBasket): void;
	removeItem(id: string): void;
	getQuantity(): number;
	getItemsId(): string[];
	getTotalPrice(): number;
	clearBasket(): void;
}
```

Интерфейс для отображения выбранных товаров в корзине

```
interface IBasketItem {
	totalPrice: number;
	item: HTMLLIElement[];
}
```

Покупатель

```
interface ICustomerModel {
	phone: string;
	email: string;
	address: string;
}
```

Интерфейс для обработки данных покупателя

```
interface ICustomerProcessingModel {
	data: ICustomerModel;
	setCustomerData(userData: Partial<ICustomerModel>): void;
	clearCustomerData(): void;
}
```

Данные заказа

```
interface IOrderModel extends ICustomerModel {
	payment: 'card' | 'cash' | '';
	total: number;
	items: string[];
}
```

Интерфейс для работы с данными заказа

```
interface IOrderMakerModel {
	order: OrderData;
	setPayment(value: OrderData['payment']): void;
	setTotalPrice(totalPrice: OrderData['total']): void;
	clearOrdeData(): void;
}
```

Интерфейс для работы с формой контактов

```
interface IOrderForm {
	spanErrors: string;
	buttonState: boolean;
	card?: boolean;
	cash?: boolean;
}
```

Интерфейс для отбражения списанной суммы

```
interface ISuccess {
	success: number;
}
```

Интерфейс для типизации полученного от сервера ответа

```
interface ResponseSuccess {
	total: number;
	id: string;
}
```

Данные id товара

```
type ItemsId = Pick<IItemModel, 'id'>;
```

Финальные данные заказа

```
type FinalOrderData = ICustomerModel & IOrderModel;
```

Данные товара используемые в шапке при выводе количества товаров

```
type ItemsQuantity = ReturnType<IItemsBasket['getQuantity']>;
```

Данные выбранной карточки в галерее

```
type ClickedGallaryItem = { item: string };
```

Данные товара, используемые в корзине

```
type ItemBasket = Pick<IItem, 'id' | 'title' | 'price'>;
```

Данные пользователя, используемые в форме для выбора оплаты и указания адреса

```
type Payment = Pick<IOrderModel, 'payment'>;
type Address = Pick<ICustomerModel, 'address'>;
```

Данные заказа, используемы в модели заказа

```
type OrderData = Pick<IOrderModel, 'payment' | 'total'>;
```

Данные пользователя, используемые в форме для выбора оплаты и указания адреса

```
type CustomerDataContacts = Pick<ICustomer, 'phone' | 'email'>;
type Email = Pick<ICustomerModel, 'email'>;
type Phone = Pick<ICustomerModel, 'phone'>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице;
- слой данных, отвечает за хранение и изменение данных;
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и объект с заголовками запросов.
Методы:

- `get` - возвращает Promise<object>, который резолвится результатом response.json() при успешном ответе, и отклоняется с ошибкой, если статус не успешный;
- `post` - принимает URI, объект данных для тела запроса и опциональный метод HTTP (по умолчанию 'POST'). Возвращает промис с объектом из JSON-ответа сервера.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие;
- `emit` - инициализация события;
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой данных

#### Класс ItemsCatalogModel

Класс отвечает за хранение и логику работы с данными товаров.\
Конструктор класса принимает инстант брокера событий и массив товаров.

- `constructor(events: IEvents)` - принимает экземпляр класса `EventEmitter` для возможности инициации событий.

В полях класса хранятся следующие данные:

- `_catalog: IItem[]` - массив объектов товаров;
- `_selectedItem: IItem` - выбранный товар, отображаемый в модальном окне;
- `_events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.

- `processImagesSrc(catalog: IItemModel[]): IItemModel[]` - осуществляет обработку адреса картинок;
- `catalog: IItem[]` - сеттер и геттер для сохранения полученного от сервера списка товаров и получения обработанного списка товаров;
- `setSelectedItem(id: string): void` - сохраняет выбранный товар для последующего вывода в модальном окне;
- `clearSelectedItem(): void` - очищает информацию о показанном в модальном окне товаре при закрытии модального окна;
- `selectedItem` - геттер для получения выбранного товара для отображения в модальном окне;
- `getItem(id: string): ItemBasket` - возвращает выбранный товар для добавления в корзину.

#### Класс BasketModel

Класс отвечает за хранение и логику работы с выбранными товарами.
Конструктор класса принимает инстант брокера событий.

- `constructor(events: IEvents)` - принимает экземпляр класса `EventEmitter` для возможности инициации событий.

В полях класса хранятся следующие данные:

- `_itemsList: ItemBasket[]` - массив выбранных товаров;
- `_events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.

- `addItem(item: ItemBasket): void` - добавляет выбранный товар в корзину;
- `removeItem(id: string): void` - удаляет выбранный товар из корзины;
- `getQuantity(): number` - позволяет получить количество выбранных товаров;
- `itemsList: ItemBasket[]` - геттер, возвращает список выбранных товаров;
- `getItemsId(): string[]` - возвращает массив id выбранных товаров;
- `getTotalPrice(): number` - позволяет получить совокупную сумму цен;
- `clearBasket(): void` - очищает корзину при удачной покупке.

#### Класс CustomerProcessingModel

Класс отвечает за сохранение и добавление данных покупателя в заказ.

- `constructor()`

Класс содержит следующие поля:

- `_customer: ICustomerMode` - объект с данными покупателя.

Класс содержит методы:

- `setCustomerData(userData: Partial<ICustomerModel>): void` - сохраняет данные покупателя для заказа;
- `data: ICustomerModel` - геттер для получения данных покупателя для заказа;
- `clearCustomerData(): void` - очищает данные покупателя после удачной покупки.

#### Класс OrderMakerModel

Класс отвечает за хранение формы оплаты и полной стоимости заказа.

- `constructor(events: IEvents)` - принимает экземпляр класса `EventEmitter` для возможности инициации событий.

Класс содержит поля:

- `_order: OrderData` - хранит объект с информацией о форме оплаты и полной стоимости заказа;
- `_events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Класс содердит методы:

- `setPayment(value: OrderData['payment'])` - сохраняет выбранную форму оплаты;
- `setTotalPrice(totalPrice: OrderData['total']): void` - сохраняет полную стоимость заказа;
- `order: OrderData` - геттер, возвращает данные формы оплаты и полной стоимости заказа;
- `clearOrdeData(): void` - очищает объект с данными о заказе после удачной покупки.

### Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Абстрактный класс ComponentView

Позволяет наследовать всем компонентам отображения поле контейнера, который будет выбран для размещения разметки, а также метод для обновления данных объекта разметки наследников.

- `constructor(container: HTMLElement)` - конструктор принимает контейнер разметки.

Поля класса:

- `_container: HTMLElement` - хранит ссылку на селектор контейнера;

Методы класса:

- `render(data?: Partial<T>): HTMLElement` - позволяет обновлять данные через сеттеры.

#### Класс HeaderView

Класс расширяет класс Component и позволяет отгбражать состояние корзины, а также предоставляет доступ к корзине.

- `constructor(container: HTMLElement, events: IEvents)` - конструктор принимает ссылку на контейнер элемента и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:

- `_buttonElement: HTMLButtonElement` - ссылка на кнопку вызова корзины в модальном окне;
- `_basketCounterElement: HTMLSpanElement` - ссылка на элемент разметки отображения состояния корзины;
- `_events: IEvents` - экземпляр класса `EventEmitter` для инициации событий.

Методы класса:

- `basketCounter(quantity: ItemsQuantity)` - сеттер для установки значения отображения состояния корзины.

#### Абстрактный класс CardView

Класс расширяет класс Component и позволяет наследовать поля названия товара и цену, так как эта информация отображается во всех карточках, а также экземпляр класса `EventEmitter`.

- `constructor(container: HTMLElement, events: IEvents)` - конструктор принимает ссылку на контейнер элемента и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:

- `_titleElement: HTMLElement` - хранит ссылку на элемент разметки, отвечающий за отображение названия товара;
- `_priceElement: HTMLSpanElement` - хранит ссылку на элемент разметки, отвечающий за отображение цены;
- `_cardId: string` - хранит id товара для возможности отображения конкретного товара;
- `_events: IEvents` - экземпляр класса `EventEmitter` для инициации событий.

Методы класса:

- `title` - сеттер для отображения названия товара;
- `id` - сеттер и геттер для сохранения и полученим id конкретного товара;
- `price` - сеттер для отображения цены.

#### Класс ItemCardView

Класс расширяет класс CardView. Класс отвечает за отображение отдельной карточки в галерее товаров.

- `constructor(container: HTMLElement, events: IEvents)` - конструктор принимает ссылку на контейнер элемента и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:

- `_imageElement: HTMLImageElement` - содержит ссылку на элемент разметки отображения картинки товара;
- `_categoryElement: HTMLSpanElement` - содержит ссылку на элемент разметки отображения информации о категории товара.

Методы класса:

- `image(src: string)` - сеттер для установки ссылки на картинку;
- `description(value: string)` - сеттер для установки отображения текста описания товара;
- `category(value: string)` - сеттер для установки отображения категории товара.

#### Класс ItemsGallaryView

Расширяет класс ComponentView. Предназначен для вывода списка товаров в галерею.

- `constructor(containerToPasteGalary: HTMLElement)` - контейнер разметки страницы, куда будет вставлятся галерея товаров.

Поля класса:

- `_catalog: HTMLElement` - контейнер разметки страницы, куда будет вставлятся галерея товаров.

Методы класса:

- `catalog(items: HTMLElement[])` - сеттер для установки карточек в галерею из массива объектов карточек.

#### Класс CardBasketView

Расширяет класс CardView. Предназначен для отображения элемента списка товара в корзине.

- `constructor(container: HTMLElement, events: IEvents)` - принимает ссылку на элемент списка товара в корзине и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:

- `_quantityItemsElement: HTMLSpanElement` - хранит ссылку на элемент, отображающий порядковый номер в списке товаров корзины;
- `_buttonDeleteElement: HTMLButtonElement` - ссылка на кнопку удаления товара из списка.

Метод класса:

- `setNumberInList(value: number): void` - устанавливает порядковый номер в элементе списка.

#### Класс BasketListView

Расширяет абстрактный класс Component. Предоставляет обёртку для списка товаров в корзине.

- `constructor(container: HTMLElement, events: IEvents)` - принимает ссылку на элемент списка товара в корзине и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:

- `_basketListElement: HTMLUListElement` - ссылка на элемент разметки для вставки элементов списка товаров;
- `_buttonToOrder: HTMLButtonElement` - ссылка на кнопку для оформления товаров;
- `basketTotalPriceElement: HTMLSpanElement` - ссылка на элемент разметки для отображения общей стоимости за весь список товаров;
- `_events: IEvents` - экземпляр класса `EventEmitter` для инициации событий;
- `_thisUsed: boolean` - поле, содержащее состояние активности отображения в данный момент.

Методы класса:

-`totalPrice(value: number)` - сеттер установки значения общей стоимости;

- `item(item: HTMLLIElement[])` - сеттер установки элементов в список;
- `isUsed(): boolean` - помогает отследить, отображался ли в данный момент данный контейнер;
- `clearProperties(): void` - сброс состояния в дефолтное.

#### Класс ModalCardView

Расширяет класс CardView. Предназначен для вывода товара в модальном окне.

- `constructor(container: HTMLElement, events: IEvents)` - принимает ссылку на элемент списка товара в корзине и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:

- `_imageElement: HTMLImageElement` - ссылка на элемент отображения картики товара;
- `_categoryElement: HTMLSpanElement` - ссылка на на элемент отображения текста и стиля категории товара;
- `_descriptionElement: HTMLParagraphElement` - ссылка на на элемент отображения текста описания товара;
- `_buttonElement: HTMLButtonElement` - ссылка на кнопку добавления/удаления товара в модальнолм окне;
- `_thisUsed: boolean` - поле, содержащее состояние активности отображения в данный момент.

  Методы класса:

- `image(src: string) HTMLElement` - сеттер для установки отображения ссылки на картинку;
- `category(value: string)` - сеттер для установки текста и стиля категории товара;
- `description(value: string)` - сеттер для установки текста описания товара;
- `override set price(value: number | null)` - переопределение родительского сеттера тображения цены товара;
- `buttonState(): void` - управляет переключением текста кнопки добавления/удаления товара в модальнолм окне;
- `buttonToBuy(): void` - переключает текст кнопки в состояние "Купить", если товар не был добавлен в корзину;
- `buttonToDelete(): void` - переключает текст кнопки в состояние "Удалить из корзины", если товар был добавлен в корзину;
- `isUsed(): boolean` - помогает отследить, отображался ли в данный момент данный контейнер;
- `clearProperties(): void` - сбрасывает состояние контейнера с его элементами отображения в дефолтное.

#### Класс ModalWrapperView

Расширяет класс ComponentView. Предназначен для вывода содержимого в модальное окно, выступая обёрткой для контента, который ему передаётся. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

- `constructor(container: HTMLElement, events: IEvents, page: HTMLElement)` - конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий, а также ссылку на элемент page страницы (для предотвращения прокрутки страницы в момент, когда модальное окно открыто).

Поля класса:

- `_closeButton: HTMLButtonElement` - элемент кнопки закрытия модального окна;
- `_contentElement: HTMLElement` - содержимое модального окна;
- `_page: HTMLElement` - ссылка на элемент page страницы;
- `_events: IEvents` - экземпляр класса `EventEmitter` для инициации событий.

Методы класса:

- `insertContentAndDisplay(content: Node): void` - помещает в разметку модального окна контент;
- `closemodalWrapperAndClear(): void` - закрывает модальное окно и сбрасывает его состояние в дефолтное.

#### Абстрактный Класс FormView

Расширяет абстрактный класс Component. Позволяет наследовать своим потомкам ссылки на разметку контейнера формы, элемента отображения ошибок при вводе в поля ввода и объявление кнопки сабмита (ссылка на конкретную кнопку производится в дочерних классах).

- `constructor(container: HTMLElement, events: IEvents)` - принимает ссылку на элемент списка товара в корзине и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:

- `_form: HTMLFormElement` - ссылка контейнер формы;
- `_formErrors: HTMLSpanElement` - элемент формы отображения ошибок;
- `_submitButton: HTMLButtonElement` - объявление ссылки кнопки сабмита;
- `_events: IEvents` - экземпляр класса `EventEmitter` для инициации событий.

Методы класса:

- `spanErrors` - сеттер, показывает/срывает сообщение об ошибке;
- `buttonState` - устанавливает активность кнопки сабмита.

#### Класс OrderFormView

Расширяет класс FormView. Предназначен для вывода формы с выбором формы оплаты и полем для ввода адреса заказа.

- `constructor(container: HTMLFormElement, events: IEvents)` - принимает ссылку на элемент списка товара в корзине и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:

- `_cardButton: HTMLButtonElement` - ссылка на элемент кнопки для выбора безналичного расчета онлайн;
- `_cashButton: HTMLButtonElement` - ссылка на элемент кнопки для выбора расчета наличными при получении;
- `_addressInput: HTMLInputElement` - ссылка на поле ввода адреса покупателя.

Методы класса:

- `card(cardPayment: boolean)` - сеттер, устанавливает кнопку для выбора безналичного расчета в состояние выбрано/невыбрано;
- `cash(cashPayment: boolean)` - сеттер, устанавливает кнопку для выбора наличного расчета в состояние выбрано/невыбрано;
- `clearForm(): void` - сбрасывает форму и кнопки.

#### Класс ContactsFormView

Расширяет класс Form. Предназначен для вывода формы для ввода контактов пользователя.
Поля класса содержат ссылки на элементы формы, а также на обработчики для реакции на действия пользователя.

- `constructor(container: HTMLFormElement, events: IEvents)` - принимает ссылку на элемент списка товара в корзине и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:

- `_emailInput: HTMLInputElement` - ссылка на поле ввода имейла;
- `_phoneInput: HTMLInputElement` - ссылка на поле ввода ермера телефона.

Методы класса:

- `clearForm(): void` - сбрасывает форму.

#### Класс ModallSuccessView

Расширяет абстрактный класс Component. Содержит разметку с указанием вывода суммы заказа, которую прислал сервер и кнопку закрытия окна, после нажатия на которую сбрасываются все состояния форм и очищаются корзина и другие данные.

- `constructor(container: HTMLFormElement, events: IEvents)` - принимает ссылку на элемент списка товара в корзине и экземпляр класса `EventEmitter` для возможности инициации событий.

Поля класса:

- `_buttonSuccess: HTMLButtonElement` - ссылка на кнопку "За покупками";
- `_descriptionElement: HTMLParagraphElement` - ссылка на элемент вывода суммы заказа, которую прислал сервер;
- `_events: IEvents` - экземпляр класса `EventEmitter` для инициации событий.

Методы класса:

-`success(value: number)` - сеттер, устанавливающий значения суммы заказа.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.\
В `index.ts` сначала получаются ссылки на контейнеры разметки, далее создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

_Список всех событий, которые могут генерироваться в системе:_\
_События изменения данных (генерируются классами моделями данных)_

- `catalog:initialized` - обработка и сохранение полученных данных;
- `item:selected` - поиск и сохранение выбранной по клику в галерее карточки для дальнейшего отображения;
- `item:added` - товар добавлен в корзину;
- `item:deleted` - товар удалён из корзины;
- `order:created` - заказ сформирован;

_События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)_

- `itemsGalleryButton:clicked` - клик по карточке в галерее;
- `modalButton:clicked` - клик по кнопке закрытия модалки или оверлею;
- `cardPreviewButton:clicked` - добавление/удаление товара по клику кнопки;
- `basketButton:clicked` - событие клика по кнопке корзины;
- `buttonDelete:clicked` - событие клика по кнопке удаления товара в списке корзины;
- `buttonToOrderClicked:clicked` - клик по кнопке для начала оформления покупки;
- `paymentButton:clicked` - выбор формы оплаты по клику на кнопку;
- `addressInput:changed` - изменение в поле ввода адреса покупателя;
- `orderForm:submit` - сабмит формы заказа;
- `emailInput:changed` - изменение в поле ввода имейла;
- `phoneInput:changed` - изменение в поле ввода номера телефона;
- `contactsForm:submit` - сабмит формы контактов;
- `successButton:clicked` - закрытие модального окна Success.

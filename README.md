# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар

```
interface IItemModel {
    id: string;
    title: string;
    image: string;
    category: string;
    description: string;
    price: number | null;
}
```

Пользователь

```
interface ICustomerModel {
    phone: string;
    email: string;
    address: string;
    payment: 'card' | 'cash' | '';
```

Интерфейс для модели данных массива товаров

```
interface IItemsCatalogModel {
    catalog: IItemModel[];
    selectedItem: IItemModel;
    saveCatalog(itemsArr: IItemModel[]): void;
    getCatalog(): IItemModel[];
    saveSelectedItem(catalog: IItemModel[]): void;
    getSelectedItem(): IItemModel;
}
```

Интерфейс для модели данных корзины товаров

```
interface IItemsBasketModel {
    itemsList: ItemBasketModel[];
    addItem(item: IItemModel): void;
    removeItem(item: IItemModel): void;
    getQuantity(): number;
    getItemsList(): ItemBasketModel[];
    getTotalPrice(): number;
    getAvailability(): boolean;
}
```

Данные заказа

```
interface IOrderModel extends ICustomerModel {
    totalPrice: number;
    items: string[];
}
```

Данные товара используемые в шапке при выводе количества товаров

```
type ItemsQuantity = ReturnType<IItemsBasketModel['getQuantity']>;
```

Данные товара, используемые в галерее при выводе

```
type ItemGallery = Pick<IItemModel, 'id' | 'image' | 'category' | 'description' | 'price'>;
type ItemGalleryArray = ItemGalleryModel[];
```

Данные товара, используемые в корзине

```
type ItemBasket = Pick<IItemModel, 'id' | 'title' | 'price'>;
```

Данные пользователя, используемые в форме для выбора оплаты и указания адреса

```
type CustomerDataPaymentAddress = Pick<ICustomerModel, 'payment' | 'address';
```

Данные пользователя, используемые в форме для выбора оплаты и указания адреса

```
type CustomerDataContacts = Pick<ICustomerModel, 'phone' | 'email'>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и объект с заголовками запросов.
Методы:

- `get` - возвращает Promise<object>, который резолвится результатом response.json() при успешном ответе, и отклоняется с ошибкой, если статус не успешный.
- `post` - принимает URI, объект данных для тела запроса и опциональный метод HTTP (по умолчанию 'POST'). Возвращает промис с объектом из JSON-ответа сервера, обрабатываемым через.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс ItemsCatalogModel

Класс отвечает за хранение и логику работы с данными товаров.\
Конструктор класса принимает инстант брокера событий и массив товаров\
В полях класса хранятся следующие данные:

- \_catalog: IItemModel[] - массив объектов товаров
- \_selectedItem: IItemModel - выбранный товар, отображаемый в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.

- getCatalog(): IItemModel[] - возвращает массив товаров.
- saveSelectedItem(item: IItemModel): void - сохраняет выбранный товар для вывода в модальном окне.
- getSelectedItem(): IItemModel - возвращает выбранный товар для вывода в модальном окне.

#### Класс ItemsBasketModel

Класс отвечает за хранение и логику работы с выбранными товарами.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:

- itemsList: ItemBasketModel[] - массив выбранных товаров.
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными.

- addItem(item: IItemModel): void - добавляет выбранный товар в корзину.
- removeItem(item: IItemModel): void - удаляет выбранный товар из корзины.
- getQuantity(): number - позволяет получить количество выбранных товаров.
- getItemsList(): IItemModel[] - возвращает список выбранных товаров.
- getTotalPrice(): number - позволяет получить совокупную сумму цен.
- getAvailability(): boolean - позволяет проверить доступность товара.

### Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Абстрактный класс ComponentView

Позволяет наследовать всем компонентам отображения поле контейнера, который будет выбран для размещения разметки, а также метод для обновления данных объекта разметки наследников.\

- constructor(container: HTMLElement, events: IEvents) - Конструктор принимает контейнер разметки и экземпляр класса `EventEmitter` для возможности инициации событий.\
  Поля класса:
- container: HTMLElement - хранит ссылку на селектор контейнера.
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.\
  Методы:
- render(data?: Partial<T>): HTMLElement - позволяет обновлять данные через сеттеры.

#### Абстрактный класс CardView

Класс расширяет класс Component и позволяет наследовать поля описания товара и цену, так как эта информация отображается во всех карточках. \

- constructor(item: ItemBasket, events: IEvents) - конструктор принимает данные товара типа ItemBasket.\
  Поля класса:
- item: ItemBasket - хранит ссылку на объект товара со значением описания и цены.

Методы класса:

- сеттеры и геттеры для получения и установки значений полей.

#### Класс BasketCardView

Расширяет класс Card. Предназначен для реализации списка товаров в корзине.
Поля класса:

- content: ItemBasket[] - массив объектов списка товаров.
- button: HTMLButtonElement - ссылка на кнопку удаления товара из списка.
- deleteItem: Function - ссылка на обработчик удаления, который навешивается на кнопку.\
- элементы разметки для вывода информации о товаре.
  Методы класса:
- getItems(): HTMLElement[] - будет возвращать массив объектов с разметкой.

#### Класс CatalogCardView

Расширяет класс Card. Предназначен для вывода списка товаров в галерею.
Поля класса:

- content: ItemGallary[] - массив объектов списка товаров.
- button: HTMLButtonElement - ссылка на кнопку в которой размещается товар из списка.
- showItem: Function - ссылка на обработчик для вывода товара в модальном окне при клике.
- элементы разметки для вывода информации о товаре.
  Методы класса:
- getItems(): HTMLElement[] - будет возвращать массив объектов с разметкой.

#### Класс ModalCard

Расширяет класс Card. Предназначен для вывода товара в модальном окне.
Поля класса:

- content: IItem - объект товара.
- button: HTMLButtonElement - ссылка на кнопку позволяющую добавить товар в корзину.
- элементы разметки для вывода информации о товаре.
  Методы класса:
- getItem(): HTMLElement - будет возвращать объект с разметкой.

#### Класс ModalWrapper

Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа. Выступает обёрткой для карточки товара и формы.\

- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.\
  Поля класса:
- modal: HTMLElement - элемент модального окна.
- events: IEvents - брокер событий.
- content: HTMLElement - содержимое модального окна.
  Методы класса:
- сеттер помещающий в разметку контент.

#### Абстрактный Класс Form

Расширяет абстрактный класс Component. Позволяет наследовать своим потомкам поле контейнера формы и поле содержащее ссылку на объект данных, содержащих данные о заказе и клиенте.\
Поля класса:

- orderData: IOrder - ссылка на объект данных.
- \_form: HTMLFormElement - элемент формы.
  Методы:
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- getInputValues(): Record<string, string> - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- setInputValues(data: Record<string, string>): void - принимает объект с данными для заполнения полей формы
- setError(data: { field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения или сокрытия текстов ошибок под полем ввода
- showInputError (field: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputError (field: string): void - очищает текст ошибки под указанным полем ввода
- close (): void - очищает поля формы и деактивируя кнопку сохранения
- get form: HTMLElement - геттер для получения элемента формы.

#### Класс OrderForm

Расширяет класс Form. Предназначен для вывода формы с выбором формы оплаты и полем для ввода адреса заказа.
Поля класса содержат ссылки на элементы формы, а также на обработчики для реакции на действия пользователя.

#### Класс ContactsForm

Расширяет класс Form. Предназначен для вывода формы для ввода контактов пользователя.
Поля класса содержат ссылки на элементы формы, а также на обработчики для реакции на действия пользователя.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

_Список всех событий, которые могут генерироваться в системе:_\
_События изменения данных (генерируются классами моделями данных)_

- `card:selected` - изменение открываемой в модальном окне картинки карточки
- `card:previewClear` - необходима очистка данных выбранной для показа в модальном окне карточки

_События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)_

- `card:open` - открытие модального окна с просмотра товара
- `item:added` - добавление товара в корзину
- `basket:open` - открытие корзины
- `item:delete` - удаление товара из корзины
- `orderItem:start` - переход к форме ввода выбора оплаты и ввода адреса
- `addPaymentAndAddress:input` - изменение данных в форме ввода выбора оплаты и ввода адреса/
- `addPaymentAndAddress:submit` - сохранение данных в форме ввода выбора оплаты и ввода адреса/
- `addContacts:input` - изменение данных в форме ввода контактов
- ` addContacts:submit` - сохранение данных в форме ввода контактов

Прилагаю UML-схему проекта.
